# Хранилища

Хранилища - это сердце моста interBTC и Kintsugi. Они отвечают за поддержание физической привязки 1:1 между BTC и interBTC.
Хранилища принимают BTC на хранение от пользователей и обеспечивают сохранность BTC, пока существует interBTC.

## Введение

Хранилища являются **недоверенными** и **обеспеченными**, и **любой пользователь может стать хранилищем**, предоставив обеспечение. Это означает: как пользователь, вы можете свободно выбрать любое хранилище, которое вам нравится, или стать своим собственным хранилищем. Вы не обязаны доверять кому-то другому, если хотите быть особо осторожным.

Правильное функционирование хранилищ обеспечивается мостом. В частности, хранилища должны доказать правильность своего поведения компоненту BTC-Relay - клиенту Bitcoin SPV, реализованному непосредственно поверх моста. Если хранилище попытается украсть BTC, это будет автоматически обнаружено, и хранилище потеряет свой залог, а пользователи получат компенсацию за счет этого залога (по выгодной стоимости).

Дополнительная обязанность хранилища - следить за Bitcoin и мостом, чтобы BTC-Relay оставался в курсе событий в главном цепочке Bitcoin, передавая заголовки блоков Bitcoin. BTC-Relay самовосстанавливается и автоматически обнаруживает и восстанавливается после форков Биткойна.

###  Чем занимаются хранилища?

1. **Предоставляют залог** и загружают свой открытый ключ Bitcoin на мост. Сумма предоставленного обеспечения определяет, сколько BTC хранилище может принять на хранение. Изначально залог может быть предоставлен в активах, включенных в белый список Управления. Первоначально это KSM на Kintsugi и DOT на Interlay.
2. **Задача**: Хранилища получают BTC от пользователей на хранение. Это блокирует залог хранилища до тех пор, пока BTC снова не будут выкуплены.
3. **Погашение**: Хранилища контролируют мост interBTC/Kintsugi на предмет запросов на выкуп. Когда пользователь запрашивает выкуп interBTC, хранилища выдают BTC пользователю и доказывают, что он вел себя правильно через BTC-Relay. Только если это доказательство верно, залог хранилища разблокируется.

Чтобы поддержать целостность моста, хранилища также могут брать на себя роль ретранслятора:

1. **Поддерживать BTC-Relay**: передавать заголовки блоков Биткойна в BTC-Relay и следить за тем, чтобы мост оставался в курсе событий в главном цепочке Биткойна.
2. **Сообщать о краже из хранилища**: отслеживать биткоин-адреса и BTC в хранилище и сообщать о краже на мост (предоставляя SPV-доказательство на BTC-Relay).

### Зачем использовать хранилище?

1. **Потенциал заработка:**

    - *interBTC*: Все хранилища являются частью пула комиссий и зарабатывают комиссии в interBTC, когда любой пользователь выпускает или обменивает interBTC.
    - *KINT* (только для Kintsugi-): Хранилища получают вознаграждение за блок KINT.
    - *KSM/DOT* (планируемая функция): В зависимости от управления, хранилища могут предоставлять обеспечение в ликвидных активах, таких как LKSM или LDOT, чтобы получать вознаграждение как от цепочки ретрансляции, так и от моста Kintsugi/interBTC.

2. **Самостоятельное хранение:** В хранилищах хранятся BTC пользователей. Если вы являетесь крупным поставщиком ликвидности, вы можете стать своим собственным хранилищем и сохранять хранение своих BTC до тех пор, пока не продадите их interBTC.

### Что мне нужно, чтобы стать хранилищем?

1. Клиент хранилища ([источник](https://github.com/interlay/interbtc-clients)).
2. Полная нода  биткойна ([инструкции](https://bitcoin.org/en/full-node)).
3. Аккаунт Polkadot ([пара открытый/закрытый ключ](https://wiki.polkadot.network/docs/en/learn-keys))
4. Некоторое количество KSM/DOT для предоставления в качестве залога и оплаты комиссий за транзакции.

Перейдите по ссылке ["Установка"](/vault/installation) для получения подробного руководства по установке.

## Модель вознаграждения

Хранилища получают комиссию за выпуск и погашение, основанную на объеме BTC.

### Распределение вознаграждения на основе пула

Хранилища получают комиссию на основе объема выпущенных и погашенных BTC. Чтобы уменьшить разброс выплат, мост реализует **модель распределения вознаграждения на основе пула**.

Каждый раз, когда пользователь выпускает или погашает InterBTC, он платит следующие сборы в **глобальный пул сборов**:

- **Выпускной сбор**: `0,5%` от объема эмиссии, оплачивается в *interBTC*.
- **Выкуп**: `0,5%` от объема выпуска, выплачивается в *interBTC*.

Из этого пула вознаграждений `100%` распределяется между всеми активными хранилищами на основе следующего коэффициента:

- 100% на основе **BTC в хранилище** (= выпущенные interBTC) пропорционально общему количеству заблокированных BTC (= выпущенные interBTC) во всех хранилищах.

В частности, комиссия каждого хранилища рассчитывается по следующей формуле:

    vault_fee =
    пул * (vault_locked_btc / total_locked_btc)

Комиссия хранилища выплачивается каждый раз, когда выполняется запрос на выпуск или погашение.

### Вознаграждение за блокчейн хранилища

Хранилища получают токены управления в качестве платы за хранение заблокированного  BTC и предоставление необходимого страхового обеспечения в активах, включенных в белый список. Ранние хранилища получают больше вознаграждений, поскольку они берут на себя больший риск с точки зрения зрелости протокола.

#### Kintsugi.

Полную информацию о вознаграждении хранилищ в канареечной сети Kintsugi можно найти в документе [Kintsugi token economy paper](https://raw.githubusercontent.com/interlay/whitepapers/master/Kintsugi_Token_Economy.pdf), опубликованном Kintsugi Labs.

#### Interlay

Вознаграждения за хранилища в основной сети Interlay пока не определены.

## Обеспечение

Чтобы у хранилищ не было стимула красть BTC пользователей, хранилища предоставляют залог в активах, включенных в белый список - по аналогичной схеме, как и в [MakerDAO](https://docs.makerdao.com/smart-contract-modules/collateral-module). Чтобы смягчить колебания обменного курса, interBTC использует *сверхзалог* и *многоуровневую схему балансировки залога*.

### Система мульти-обеспечения

Парачейн поддерживает использование различных активов в качестве залога. Управление составляет белый список активов, которые принимаются в качестве залога, указывая различные пороги безопасности, а также максимальное предложение для каждого актива.

Хранилища идентифицируются уникальным `VaultId`, который представляет собой кортеж из:

``(AccountId, CollateralCurrency, WrappedCurrency)``.

где `CollateralCurrency` - залоговый актив, используемый данным хранилищем, а `WrappedCurrency` - резервный актив 1:1 (BTC).

Это различие между `AccountId` и `VaultId` позволяет нам легко добавлять *больше залоговых активов*, а также *залоговые активы, отличные от BTC*, такие как Litecoin, Dogecoin, ZCash и т.д.

#### Изоляция хранилищ

Оператор хранилища может управлять несколькими хранилищами с разными `VaultId` с разными валютами обеспечения, используя один и тот же `AccountId`.
Каждое хранилище, идентифицированное уникальным `VaultId`, изолировано от всех других хранилищ.

Это означает:

- Ликвидация затрагивает только конкретное `VaultId`.
- Операторы хранилищ должны принимать активные меры для восстановления баланса между различными активами обеспечения.

Когда пользователи запрашивают возможность чеканки InterBTC, они выбирают определенный `VaultId` для блокировки BTC. Обычно пользователи не заботятся о том, в каком хранилище они хотят чеканить (если только в будущем не появится конкурентный рынок комиссий), и принимают автоматический выбор, предлагаемый пользовательским интерфейсом.

При обмене InterBTC на BTC пользователи снова выбирают конкретный `VaultId`. В данном случае выбор имеет отношение к *безопасности*: Если хранилища не могут выполнить запрос на погашение, пользователи имеют право

- (a) повторить попытку с другим Vault и потребовать небольшой штраф в обеспечении хранилища (`CollateralCurrency`, связанный с `VaultId`);
- (b) запросить возмещение в `валюте обеспечения` этого конкретного хранилища.

#### Несколько идентификаторов хранилища - один клиент хранилища

 [Клиент хранилища](https://github.com/interlay/interbtc-clients/tree/master/vault) управляет всеми `VaultId`, связанными с данным `AccountId`. Это означает, что оператору хранилища нужно запускать только *один оф-чейн клиент*.

Операторы хранилищ могут регистрировать новые `VaultId` через пользовательский интерфейс, и клиент хранилища автоматически начнет управлять ими.

### Избыточное обеспечение

Хранилища должны иметь избыточное обеспечение своих BTC. Точный порог определяется для каждого принимаемого залогового актива. Актуальные пороги залога можно проверить, обратившись к хранилищу парачейна, например, через [Polkadot.js Apps](https://polkadot.js.org/apps/#/explorer).

**Пример, используемый для объяснения:** Далее в качестве примера** мы используем залог DOT с коэффициентом избыточного обеспечения `150%`.

Это означает, что сумма BTC, которую хранилище может принять на хранение, рассчитывается следующим образом:

    max_vault_btc = vault_dot_collateral / (dot_collateral_threshold * btc_dot_exchange_rate)

Где `dot_collateral_threshold = 1.5` (`150%`), согласно нашему примеру.

### Перебалансировка обеспечения на уровне хранилища

Для защиты от краткосрочных и долгосрочных колебаний обменного курса хранилища **инструктируются поддерживать уровень обеспечения в актуальном состоянии**.
Это может быть достигнуто двумя способами:

- **interBTC Redeem**: если пользователи пополняют счет в хранилище, коэффициент обеспечения увеличивается. Хранилище также может поддерживать резерв interBTC и осуществлять самопогашение для быстрого восстановления баланса.
- **Увеличение залога**: в качестве альтернативы, хранилище может добавить больше залога в систему.

## Пороги обеспечения

Мост interBTC вводит несколько пороговых значений с различными действиями, чтобы гарантировать, что хранилища никогда не упадут ниже 100% обеспечения:

Мы опубликуем сообщение с подробным описанием того, как рассчитываются эти пороговые значения с учетом ликвидности и профиля риска для каждого залогового актива.

### Обеспечение залога

#### Действия

Нет необходимости. Хранилище может свободно выкупить любой "неиспользованный" залог, превышающий порог `150%`.

#### Пороговые значения

<!-- tabs:start -->

#### **Тестнет**

Testnet DOT: `150%`

#### **Kintsugi (Канареечная сеть)**.

KSM: `260%`

#### **Interlay ( Майннет)**.

DOT: неизвестно

<!-- tabs:end -->

### Премиум Погашение

#### Действия

Пользователи могут выполнить выкуп с помощью этого хранилища и получить премию в размере `5%` в DOT в дополнение к выкупленным BTC.

#### Пороговые значения

<!-- tabs:start -->

#### **Testnet**

Testnet DOT: `135%`

#### **Kintsugi (Канареечная сеть)**.

KSM: `200%`

#### **Interlay (Майннет)**.

DOT: неизвестно

<!-- tabs:end -->

### Ликвидация хранилища

#### Действие

Хранилище с недостаточным обеспечением ликвидируется.

1. Весь залог хранилища сокращается.
2. Мост interBTC инициирует ликвидационный своп в порядке поступления: любой пользователь может **сжечь interBTC** в обмен на обеспечение по премиальной ставке. См. **[Событие сожжения](/overview?id=burn-event-restoring-a-11-physical-peg)** ниже.

#### Пороговые значения

<!-- tabs:start -->

#### **Тестнет**.

Testnet DOT: `110%`

#### **Kintsugi (Канареечная сеть)**.

KSM: `150%`

#### **Interlay ( Майннет)**.

DOT: неизвестно

<!-- tabs:end -->

## Ликвидация

Если хранилища не могут вести себя в соответствии с правилами протокола, они подвергаются наказанию в виде ликвидации залога.
Существует 2 типа отказов: **сбои безопасности** и **сбои аварии**.

Если хранилище не выполняет выкуп вовремя, крадет BTC или опускается ниже порога ликвидационного залога, инициируется событие ликвидации.

### Сбои в системе безопасности

Сбой безопасности происходит в двух случаях:

- **Кража**: считается, что хранилище совершило кражу, если оно перемещает/расходует BTC с несанкционированного моста interBTC. Кража обнаруживается и сообщается [Хранилища](/vault/overview) через SPV-доказательство.

- **Серьезное невозможность обеспечить залог**: хранилище опускается ниже порога ликвидационного залога (например, `110%` в тестнете).

В обоих случаях **весь залог хранилища ликвидируется - до порогового значения безопасного залога (например, `150%` на тестнете) от ликвидационной стоимости BTC - и хранилища BTC считаются потерянными**.

Следовательно, мост interBTC инициирует **[Событие сожжения](/vault/overview?id=burn-event-restoring-a-11-physical-peg)** для восстановления баланса 1:1 между BTC и interBTC.

### Сбои в работе хранилищ (неудачное погашение)

Если хранилища выходят из сети и не могут выполнить погашение, они:

- **Пенализированы** (**снижена плата штрафа**) и
- **Временно запрещено**, например, на `24 часа`, принимать дальнейшие запросы на погашение.

Размер **штрафа** рассчитывается в процентах (например, `10%`) от суммы выкупа по текущему курсу.

## Событие сожжения: Восстановление физической привязки 1:1

Когда хранилище ликвидируется, его залог уменьшается до порога безопасного залога (например, `150%` на testnet) от стоимости ликвидированных BTC, учитывая обменный курс на момент ликвидации.

Теперь на мосту interBTC заблокировано меньше BTC, чем добыто interBTC - но более чем достаточно залога для поддержания экономической безопасности.
Чтобы восстановить физическую привязку 1:1 между BTC и interBTC, мост interBTC позволяет пользователям **сжечь interBTC в обмен на залог по премиальной ставке**.

В частности, выплата пользователю рассчитывается следующим образом:

    burn_payout =
        (total_liquidated_collateral / total_liquidated_interbtc)
        * пользовательский_сгоревший_interbtc

До тех пор, пока экономическая ценность `burn_payout` выше, чем `user_burned_interbtc`, которая может включать частную информацию пользователя (то есть, пользователь может думать, что залоговый актив скоро станет стоить больше), пользователи стимулируются сжигать interBTC в обмен на залоговый актив и восстанавливать баланс системы.

Это событие сжигания продолжается до тех пор, пока не восстановится соотношение 1:1 между BTC и interBTC.
